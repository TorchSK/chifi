import{l as R,c as d,e as p,f as e,H as D,r as A,i as Q,K as M,h as r,t as I,B as m,D as B,w as f,T as G,n as V,k as x,Q as L,V as U,S as j,g as z,F as N,C as q,A as E,v as J}from"./YKJGr53e.js";import{_ as F}from"./rFhTn0FA.js";import{u as H}from"./s3-Ad5Vt.js";import{S as W,M as X,b as Z,g as Y}from"./BejFaCWX.js";import{_ as ee}from"./Di7j-vHa.js";import{u as te}from"./CTAIbY_z.js";import"./srjAdVVy.js";import"./DxjlTc0-.js";import"./BQkc-AXV.js";import"./KtzzS9P3.js";import"./BboEKukF.js";import"./BIqF7sE6.js";import"./Ch-6yXfM.js";import"./Be8J6HL0.js";import"./Djmrkajt.js";import"./BGcilHqP.js";import"./C3Kc88JK.js";import"./BgjWWMr1.js";import"./BHB5aYOm.js";import"./BD8WLPty.js";import"./D7Q_Jaex.js";import"./CRYKUuUC.js";import"./Bkkvs3X8.js";const se={},oe={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 256 256"},ne=e("path",{d:"M240,94c0,70-103.79,126.66-108.21,129a8,8,0,0,1-7.58,0C119.79,220.66,16,164,16,94A62.07,62.07,0,0,1,78,32c20.65,0,38.73,8.88,50,23.89C139.27,40.88,157.35,32,178,32A62.07,62.07,0,0,1,240,94Z"},null,-1),le=[ne];function ie(o,n){return d(),p("svg",oe,le)}const ae=R(se,[["render",ie]]),ce={},re={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 256 256"},me=e("path",{d:"M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"},null,-1),de=[me];function ue(o,n){return d(),p("svg",re,de)}const _e=R(ce,[["render",ue]]),fe={},pe={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 256 256"},ve=e("path",{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"},null,-1),he=[ve];function xe(o,n){return d(),p("svg",pe,he)}const ge=R(fe,[["render",xe]]),we={class:"flex w-full mt-2 items-start"},ke={class:"mr-2 bg-white relative z-[55] text-gray-500"},ye={class:"flex-grow"},Ce={class:"text-xs font-semibold text-gray-700 mb-1 bg-white relative z-[99]"},be={class:"text-sm bg-white"},$e={class:"flex gap-2 mt-2 items-center mb-2"},Ie={class:"text-sm"},Ae={class:"cursor-pointer"},Be={class:"px-1 py-1"},Te={key:0,class:"ml-0"},Me={class:"flex gap-2 justify-end max-w-[800px]"},Re={class:"ml-8 relative"},P={__name:"CommentChild",props:{comment:{type:Object}},emits:["comment","like","dislike","delete","edit"],setup(o,{emit:n}){const i=H(),l=D(),g=A(null),v=A(),u=n,w=async a=>{const t={text:v.value,profile_id:i.value.id,parent_id:a},{data:s}=await l.from("comments").insert(t).select().single();u("comment",s),g.value=null,v.value=null},k=Q("guest");k.value=k.value||Math.random().toString(36).slice(2,14);const C=async a=>{if(a.likes.map(t=>t.profile_id).includes(i.value.id))i?C.profile_id=i.value.id:k.value,await l.from("likes").delete().eq("comment_id",a.id).eq("profile_id",i.value.id),u("dislike",{comment:a,like:a.likes.find(t=>t.profile_id==i.value.id)});else{const t={comment_id:a.id};i?t.profile_id=i.value.id:k.value,await l.from("likes").insert(t),u("like",{comment:a,like:t})}},b=async a=>{await l.from("comments").delete().eq("id",a.id),u("delete",a)};return(a,t)=>{const s=M("IconsUser"),c=ae,h=_e,$=ge,T=M("IconsEdit"),y=M("IconsCross"),S=F,O=P;return d(),p("div",null,[e("div",we,[e("div",ke,[r(s,{class:"w-6 h-6"})]),e("div",ye,[e("div",Ce,I(o.comment.profiles.username),1),e("div",be,I(o.comment.text),1),e("div",$e,[e("div",{class:"inline-flex items-center hover:bg-gray-200 cursor-pointer px-1 py-0.5 rounded -ml-1",onClick:t[0]||(t[0]=_=>C(o.comment))},[o.comment.likes.map(_=>_.profile_id).includes(m(i).id)?(d(),B(c,{key:0,class:"w-4 h-4 mr-1 text-red-500"})):(d(),B(h,{key:1,class:"w-4 h-4 mr-1"})),e("div",Ie,I(o.comment.likes.length),1)]),e("div",{class:"text-sm text-gray-700 inline-block cursor-pointer",onClick:t[1]||(t[1]=_=>g.value=o.comment.id)},"Reply"),e("div",Ae,[r(m(Y),{as:"div",class:"relative inline-block text-left"},{default:f(()=>[r(m(W),null,{default:f(()=>[r($,{class:"w-5 h-5 ml-2"})]),_:1}),r(G,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:f(()=>[r(m(X),{class:"absolute left-0 mt-2 w-56 origin-top-left divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-[999]"},{default:f(()=>[e("div",Be,[r(m(Z),null,{default:f(({active:_})=>[e("button",{class:V([_?"bg-violet-500 text-white":"text-gray-900","group flex w-full items-center rounded-md px-2 py-2 text-sm"]),onClick:t[2]||(t[2]=K=>a.editComment(o.comment))},[r(T,{class:"mr-2 h-5 w-5","aria-hidden":"true"}),x(" Edit ")],2)]),_:1}),r(m(Z),null,{default:f(({active:_})=>[e("button",{class:V([_?"bg-violet-500 text-white":"text-gray-900","group flex w-full items-center rounded-md px-2 py-2 text-sm"]),onClick:t[3]||(t[3]=K=>b(o.comment))},[r(y,{class:"mr-2 h-5 w-5 text-red-500","aria-hidden":"true"}),x(" Delete ")],2)]),_:1})])]),_:1})]),_:1})]),_:1})])]),m(g)==o.comment.id?(d(),p("div",Te,[L(e("textarea",{class:"w-full max-w-[800px] border border-gray-300 rounded-lg focus:outline-none p-4",rows:"4","onUpdate:modelValue":t[4]||(t[4]=_=>j(v)?v.value=_:null)},null,512),[[U,m(v)]]),e("div",Me,[r(S,{color:"red"},{default:f(()=>[x("Cancel")]),_:1}),r(S,{color:"blue",onClick:t[5]||(t[5]=_=>w(o.comment.id))},{default:f(()=>[x("Reply")]),_:1})])])):z("",!0)])]),e("ul",null,[(d(!0),p(N,null,q(o.comment.children,_=>(d(),p("li",Re,[r(O,{comment:_,onDelete:b},null,8,["comment"])]))),256))])])}}},Se=o=>{const n=Object.create(null);o.forEach(l=>n[l.id]={...l,children:[]});const i=[];return o.forEach(l=>{l.parent_id?n[l.parent_id].children.push(n[l.id]):i.push(n[l.id])}),i},Ve={class:"mt-24"},Ee=e("h2",{class:"font-black text-4xl mb-6"},"Comments",-1),Ze={class:"mb-12 flex flex-col gap-3 relative"},De={class:"relative"},Le={key:0,class:"text-sm mb-1 text-gray-500"},Ue={class:"font-semibold"},je={class:"flex justify-end"},rt={__name:"Comments",async setup(o){let n,i;const l=H(),g=D(),v=A();l.value&&(v.value=([n,i]=E(()=>$fetch("/api/users/"+l.value.id)),n=await n,i(),n));const{data:u}=([n,i]=E(async()=>te("comments",async()=>{const{data:s}=await g.from("comments").select("*, profiles(*), likes(*)");return s})),n=await n,i(),n),w=A(),k=async()=>{var s={text:w.value,profile_id:l.value.id};const{data:c}=await g.from("comments").insert(s).select().single();c.profiles={username:v.value.username},c.likes=[],u.value.push(c)},C=async s=>{s.profiles={username:v.value.username},s.likes=[],u.value.push(s)},b=async s=>{u.value.find(c=>c.id==s.comment.id).likes.push(s.like)},a=async s=>{const c=u.value.find(h=>h.id==s.comment.id);c.likes.splice(c.likes.findIndex(h=>h.id==s.like.id),1)},t=s=>{u.value.splice(u.value.findIndex(c=>c.id==s.id),1)};return(s,c)=>{const h=P,$=F,T=ee;return d(),p("div",Ve,[Ee,e("ul",Ze,[(d(!0),p(N,null,q(("useCreateTree"in s?s.useCreateTree:m(Se))(m(u)),y=>(d(),p("li",De,[r(h,{comment:y,onComment:C,onLike:b,onDislike:a,onDelete:t},null,8,["comment"])]))),256))]),e("div",null,[m(l)?(d(),p("div",Le,[x("Commenting as "),e("span",Ue,I(m(v).username),1)])):z("",!0),L(e("textarea",{class:"w-full border border-gray-300 dark:border-gray-700 rounded-lg focus:outline-none p-4 dark:bg-gray-800",rows:"4","onUpdate:modelValue":c[0]||(c[0]=y=>j(w)?w.value=y:null)},null,512),[[U,m(w)]])]),e("div",je,[m(l)?(d(),B($,{key:0,color:"blue",onClick:k},{default:f(()=>[x("Add comment")]),_:1})):(d(),B(T,{key:1,to:"/login?redirect="+("useRoute"in s?s.useRoute:m(J))().fullPath+"#comments"},{default:f(()=>[r($,{color:"gray"},{default:f(()=>[x("Login to comment")]),_:1})]),_:1},8,["to"]))])])}}};export{rt as default};
